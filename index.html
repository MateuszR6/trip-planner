<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Mapa Punktów - Atrakcje, Jedzenie, Noclegi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      padding: 1rem;
    }

    #map {
      height: 400px;
      width: 100%;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 1rem;
      justify-content: center;
    }

    #filter, #search {
      padding: 0.5rem;
      font-size: 1rem;
    }

    #pointsList {
      padding: 1rem;
    }

    .point {
      border: 1px solid #ddd;
      border-radius: 5px;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }

    .btn {
      padding: 0.3rem 0.6rem;
      margin-left: 0.3rem;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .edit { background-color: #f0ad4e; color: white; }
    .delete { background-color: #d9534f; color: white; }
  </style>
</head>
<body>

<h1>Interaktywna Mapa Punktów</h1>
<div id="map"></div>

<div id="controls">
  <select id="filter">
    <option value="all">Wszystkie</option>
    <option value="atrakcja">Atrakcja</option>
    <option value="jedzenie">Jedzenie</option>
    <option value="nocleg">Nocleg</option>
  </select>
  <input type="text" id="search" placeholder="Szukaj po nazwie..." />
</div>

<div id="pointsList"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([52.2297, 21.0122], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const markers = [];
  let points = JSON.parse(localStorage.getItem("points")) || [];

  const icons = {
    atrakcja: L.icon({ iconUrl: "https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png", iconSize: [24, 24] }),
    jedzenie: L.icon({ iconUrl: "https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png", iconSize: [24, 24] }),
    nocleg: L.icon({ iconUrl: "https://maps.gstatic.com/mapfiles/ms2/micons/green-dot.png", iconSize: [24, 24] }),
  };

  function promptPoint(latlng) {
    const type = prompt("Wybierz typ punktu: atrakcja / jedzenie / nocleg").toLowerCase();
    if (!['atrakcja', 'jedzenie', 'nocleg'].includes(type)) return;

    const name = prompt("Nazwa:");
    if (!name) return;

    const description = prompt("Opis:");
    const address = prompt("Adres:");
    const cost = prompt("Koszt:");

    const point = { lat: latlng.lat, lng: latlng.lng, type, name, description, address, cost };
    points.push(point);
    savePoints();
    renderPoints();
  }

  map.on('click', (e) => promptPoint(e.latlng));

  function renderPoints() {
    // Clear existing markers
    markers.forEach(m => map.removeLayer(m));
    markers.length = 0;

    const filter = document.getElementById("filter").value;
    const search = document.getElementById("search").value.toLowerCase();

    document.getElementById("pointsList").innerHTML = "";

    points.forEach((point, index) => {
      if ((filter !== 'all' && point.type !== filter) || (search && !point.name.toLowerCase().includes(search))) return;

      const marker = L.marker([point.lat, point.lng], { icon: icons[point.type] }).addTo(map)
        .bindPopup(`<strong>${point.name}</strong><br>${point.description}`);
      markers.push(marker);

      const div = document.createElement('div');
      div.className = "point";
      div.innerHTML = `
        <strong>${point.name}</strong> (${point.type})<br>
        Opis: ${point.description}<br>
        Adres: ${point.address}<br>
        Koszt: ${point.cost} zł<br>
        <button class="btn edit" onclick="editPoint(${index})">Edytuj</button>
        <button class="btn delete" onclick="deletePoint(${index})">Usuń</button>
      `;
      document.getElementById("pointsList").appendChild(div);
    });
  }

  function editPoint(index) {
    const point = points[index];
    const name = prompt("Nowa nazwa:", point.name);
    if (!name) return;
    const description = prompt("Nowy opis:", point.description);
    const address = prompt("Nowy adres:", point.address);
    const cost = prompt("Nowy koszt:", point.cost);

    points[index] = { ...point, name, description, address, cost };
    savePoints();
    renderPoints();
  }

  function deletePoint(index) {
    if (confirm("Czy na pewno chcesz usunąć ten punkt?")) {
      points.splice(index, 1);
      savePoints();
      renderPoints();
    }
  }

  function savePoints() {
    localStorage.setItem("points", JSON.stringify(points));
  }

  document.getElementById("filter").addEventListener("change", renderPoints);
  document.getElementById("search").addEventListener("input", renderPoints);

  renderPoints();
</script>

</body>
</html>
